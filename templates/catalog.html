{% extends "base.html" %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static',filename='styles/catalog.css') }}"> 
{% endblock %}

{% block content %}
<div class="catalog-side">
    <div class="title">Filter</div>
    {% for d1 in category_tree %}
        <div class="d1">
            {{ d1.category_name }}
            {% if d1.children|length > 0 %}
            <span class="expand-icon"><img src="{{ url_for('static', filename='icons/plus.svg') }}"></span>
            {% endif %}
            <div class="children" style="display: none;">
                {% for d2 in d1.children %}
                    <div class="d2">
                        {{ d2.category_name }}
                        {% if d2.children|length > 0 %}
                        <span class="expand-icon"><img src="{{ url_for('static', filename='icons/plus.svg') }}" loading="lazy"></span>
                        {% endif %}
                        <div class="children" style="display: none;">
                            {% for d3 in d2.children %}
                                <div class="d3">{{ d3.category_name }}</div>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</div>
<div class="catalog-main">
    <div id="sort">
        <label class="label" for="sort">Sort by</label>
        <select class="options" name="sort" id="sort">
            <option>Recommended</option>
            <option>Most Popular</option>
            <option>New Arrivals</option>
            <option>Top Rated</option>
            <option>Price Low to High</option>
            <option>Price High to Low</option>
        </select>
    </div>
    <div class="clothing">
        {% for product in products_list %}
        <div class="item" data-url="{{ url_for('viewproduct', product_id=product.product_id) }}">
            <div class="image-container">
                <img src="{{ url_for('static', filename='uploads/' + product.image_url) }}" alt="{{ product.product_name }}" fill>
            </div>
            <div class="name">{{ product.product_name }}</div>
            <div class="price">â‚±{{ product.price }}</div>
        </div>
        {% endfor %}
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        // for expand icons
        document.querySelectorAll('.expand-icon').forEach(icon => {
            icon.addEventListener('click', (event) => {
                const children_div = icon.parentElement.querySelector('.children');
                if (children_div) {
                    if (children_div.style.display === 'none') {
                        children_div.style.display = 'block';
                        icon.querySelector('img').src = "{{ url_for('static', filename='icons/minus.svg') }}";
                    } else {
                        children_div.style.display = 'none';
                        icon.querySelector('img').src = "{{ url_for('static', filename='icons/plus.svg') }}";
                    }
                }
            });
        });

        // link to product page
        document.querySelectorAll('.item').forEach(item => {
            item.addEventListener('click', (event) => {
                event.preventDefault();
                const url = item.getAttribute('data-url');
                window.location.href = url;
            });
        });
    });
</script>
{% endblock %}